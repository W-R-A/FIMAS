<!doctype html>
<html lang="en-GB">

<head>
    <!-- Declare charset used at UTF-8 -->
    <meta charset="UTF-8">

    <!-- Title of the webpage -->
    <title>FIMAS Main Page</title>

    <!-- Link to stylesheet -->
    <link rel="stylesheet" type="text/css" href="styles.css">

    <!-- Set initial scale for devices with smaller screens -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>

<body>
    <header>
        <ul>
            <li><a class="active" href="index.html">Home</a></li>
            <li><a href="deviceConfig.html">Device Configuration</a></li>
            <li><a href="routines.html">Routines Configuration</a></li>
            <li><a href="help.html">Help</a></li>
            <li style="float:right; background-color:red"><a href="estop">Emergency Stop</a></li>
            
        </ul>
    </header>

    <div class="main">
        <h1>Welcome</h1>

        <p>Select a routine to run</p>

        <!-- Dropdown to select the routine to run -->
        <select id="routines_dropdown"></select>

        <!-- Test the devices used in the routine -->
        <button class="btnTstDevices">Test Devices</button>

        <!-- Run the Routine -->
        <button class="btnRunRoutine">Run the Routine</button>

    </div>
    <script src="functions.js"></script>
    <script src="jquery.js"></script>

    <script>
        //When the web page has loaded and the the document is ready to be worked on
        $(document).ready(function () {
            //Populate the routines dropdown
            var res = populateRoutines("routines_dropdown");

            //Check if failed - code non-zero
            if (res.code) {
                //Alert that an error occurred
                alert("Error populating routines");

                //Log specific error
                console.log(res.msg);
            }

            //Bind the test button to the following handler
            $(document).on("click", "button.btnTstDevices", function (event) {

                //Get the ID of the selected routine
                var routineID = $('select[id="routines_dropdown"] option:selected').attr('class');

                //Check if a valid routine has been selected
                if (typeof routineID == "undefined") {
                    //Tell the user to select a valid device
                    alert("Please select a routine, or create one if none are available");
                    //Return and do not execute the rest of the function as there is an invalid input
                    return 0;
                }

                //Define the URL to hit
                var reqURL = '/testdevices/routineid=' + routineID;

                //Debugging, display the URL to send a GET request to
                //alert(reqURL);

                //Send the AJAX request to the defined URL
                $.ajax({
                    type: "GET",
                    url: reqURL,
                    //On success, alert the user
                    success: function (result) {
                        alert('Device test successful');
                    },
                    //On failure, alert the user
                    error: function (result) {
                        alert('There is an issue with a device');
                    }
                });
            });
        });
    </script>
</body>

</html>